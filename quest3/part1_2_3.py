# /// script
# requires-python = ">=3.12"
# dependencies = [
#     "rich",
# ]
# ///


from rich import print

TEST_INPUT = """..........
..###.##..
...####...
..######..
..######..
...####...
.........."""

INPUT = """..............................
..............................
.............##...............
.............##....#..........
...........#.#####.#..........
........##.##########.........
........#############.........
.........#############........
..........#########.##........
..........######.##.#.........
.............##...#...........
..................#...........
..............................
.............................."""

PART_TWO_INPUT = """......................................................................
......................................................................
......................................................................
....................................#.................................
............................##.###..#.#...............................
............................###########...............................
............................###########.#..##.........................
............................#################.........................
.............................##################..##...................
.............................#################..###...................
.......................#..#########################...................
.......................##############################.................
.......................###############################................
.......................############################...................
.....................#############################..#.................
....................##################################................
....................#.################################................
......................#############..################.................
.....................################################.................
....................###################################...............
.....................##############################.#.................
......................###########################.....................
.......................#############################..................
.......................############################...................
.......................############################...................
........................###########################...................
........................#####.####################....................
.........................####..###################....................
...........................#....##################....................
..................................############.##.....................
...................................##########.........................
..................................#########.#.........................
....................................######............................
......................................###.............................
......................................................................"""


PART_THREE_INPUT = """########################.................................................................................................#####################
#.####################........................................#.......#...................................................##################.#
######################.......................................##.......##...........#.......................................###################
##################.........................................#####......####.......#.##.......................................##################
###################........................................########..#######.....####.......................................##################
###################.........................................###.#############.#########......................................#################
###################........................................############################......................................#################
#################.#.......................................#############################......................................#################
#################........................................###############################......................................################
##################......................................#..#############################.....................................#.###############
##################..#................................######################################..................................#################
###################.#...............................######################################...................................#################
######################..............................####################################.#..................................##################
####################.#............................#########################################...............................####################
###########.#.###.#...............................#########################################.................................##################
##############..####.............................##########################################.................................##################
################...............................##########################################....................................###############..
################...............................##########################################.....................................##############..
###############...............................###########################################....................................#####..#########.
###########.###...............................#############################################................................#####.#..########..
#########....#.................................#############################################..................................#......#####....
.##..####.....................................###############################################......#.................................###......
......####........................................###########################################......#..........................................
......####.........................................##################......####################.##.##.........................................
.......###........................................##################.######.###################.#####.........................................
...................................................################.###..###.########################.........................................
...................................................################.###..###.######################...........................................
................................................#.##################.######.#######################...........................................
................................................#####################......#########################..........................................
...............................................#####################################################..........................................
..............................................###################################################.............................................
..............................................###################################################.........................................#...
..............................................###################################################.........................................#...
..#...#.......................................##################################################.........................................##...
.###..##.....................................###################################################........................................###...
###....#..#..................................###################################################....................................#..#######
###.#########..................................################################################..................................#############
##############..................................###.########################################......................................############
#############..................................###...#####################################.#....................................##############
##############.....................................######################################.....................................#...############
################....................................#####################################....................................#################
################....................................##################################.....................................###################
###############......................................##############################.#......................................###################
##################...................................###############################.......................................###################
###################.....................................###########################........................................###################
#####################.....................................######..############..##.......................................#.###################
#####################......................................###.....#....###.#.........................................####..##################
#####################.......................................#...........#............................................#########################
#####################.......................................##........................................................#####.##################
####################..................................................................................................########################
#.##################....................................................................................................####################.#
#####################.....................................................................................................####################"""


def parse(input):
    return [list(line) for line in input.splitlines()]


def remove_first_layer(parsed_input):
    total_removed_blocks = 0
    for row in range(len(parsed_input)):
        for column in range(len(parsed_input[row])):
            if parsed_input[row][column] == "#":
                parsed_input[row][column] = "1"
                total_removed_blocks += 1
    return total_removed_blocks


def remove_layer(parsed_input, previous_value, next_value):
    total_removed_blocks = 0
    saved_points = []
    for row in range(len(parsed_input)):
        for column in range(len(parsed_input[0])):
            adjacent_points = [
                (r, c)
                for r, c in [(row - 1, column), (row + 1, column), (row, column - 1), (row, column + 1)]
                if 0 <= r < len(parsed_input) and 0 <= c < len(parsed_input[0])
            ]

            get_adjacent_values = [True for r, c in adjacent_points if parsed_input[r][c] == str(previous_value)]
            if len(get_adjacent_values) == 4 and all(get_adjacent_values):
                saved_points.append((row, column))
                total_removed_blocks += 1

    for row, column in saved_points:
        parsed_input[row][column] = str(next_value)

    return total_removed_blocks


# test input
def part1(input):
    parsed_input = parse(input)
    total_removed_blocks = remove_first_layer(parsed_input)
    previous_value = 1
    next_value = 2
    while total_removed_blocks:
        removed_blocks = remove_layer(parsed_input, previous_value, next_value)
        if removed_blocks == 0:
            break
        total_removed_blocks += removed_blocks
        previous_value += 1
        next_value += 1

    return total_removed_blocks


assert part1(TEST_INPUT) == 35

print(part1(TEST_INPUT))
print(part1(INPUT))
print(part1(PART_TWO_INPUT))


def remove_layer_part3(parsed_input, previous_value, next_value):
    total_removed_blocks = 0
    saved_points = []
    for row in range(len(parsed_input)):
        for column in range(len(parsed_input[row])):
            if parsed_input[row][column] == ".":
                continue

            adjacent_points = [
                (r, c)
                for r, c in [
                    (row - 1, column),
                    (row + 1, column),
                    (row, column - 1),
                    (row, column + 1),
                    (row - 1, column - 1),
                    (row + 1, column - 1),
                    (row - 1, column + 1),
                    (row + 1, column + 1),
                ]
                if 0 <= r < len(parsed_input) and 0 <= c < len(parsed_input[row])
            ]

            get_adjacent_values = [True for r, c in adjacent_points if parsed_input[r][c] == str(previous_value)]
            if len(get_adjacent_values) == 8 and all(get_adjacent_values):
                saved_points.append((row, column))
                total_removed_blocks += 1

    for row, column in saved_points:
        parsed_input[row][column] = str(next_value)

    return total_removed_blocks


# test input
def part3(input):
    parsed_input = parse(input)
    total_removed_blocks = remove_first_layer(parsed_input)
    previous_value = 1
    next_value = 2
    while total_removed_blocks:
        removed_blocks = remove_layer_part3(parsed_input, previous_value, next_value)
        if removed_blocks == 0:
            break
        total_removed_blocks += removed_blocks
        previous_value += 1
        next_value += 1

    return total_removed_blocks


assert part3(TEST_INPUT) == 29


print(part3(PART_THREE_INPUT))
